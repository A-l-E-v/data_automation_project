. .venv/bin/activate && pytest
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.4.1, pluggy-1.6.0 -- /home/al/data_automation_project/.venv/bin/python3
cachedir: .pytest_cache
rootdir: /home/al/data_automation_project
configfile: pytest.ini
plugins: cov-6.2.1
collecting ... collected 7 items

tests/test_cleaner.py::test_impute_and_encode_and_scale_and_dates PASSED [ 14%]
tests/test_loader.py::test_load_csv 
-------------------------------- live log call ---------------------------------
2025-08-26 13:55:27 | INFO     | src.io.loader:19 - CSV loaded: /tmp/pytest-of-al/pytest-6/test_load_csv0/t.csv shape=(2, 2)
PASSED                                                                   [ 28%]
tests/test_loader.py::test_load_excel 
-------------------------------- live log call ---------------------------------
2025-08-26 13:55:28 | INFO     | src.io.loader:35 - Excel loaded: /tmp/pytest-of-al/pytest-6/test_load_excel0/t.xlsx sheet=None shape=(2, 2)
PASSED                                                                   [ 42%]
tests/test_pipeline.py::test_pipeline_minimal 
-------------------------------- live log call ---------------------------------
2025-08-26 13:55:28 | INFO     | src.pipelines.runner:19 - Старт конвейера
2025-08-26 13:55:28 | INFO     | src.pipelines.io_stage:17 - Загрузка CSV: data/raw/sales.csv
2025-08-26 13:55:28 | INFO     | src.io.loader:19 - CSV loaded: data/raw/sales.csv shape=(1000, 4)
2025-08-26 13:55:28 | INFO     | src.pipelines.io_stage:17 - Загрузка CSV: data/raw/customers.csv
2025-08-26 13:55:28 | INFO     | src.io.loader:19 - CSV loaded: data/raw/customers.csv shape=(200, 2)
2025-08-26 13:55:28 | INFO     | src.pipelines.io_stage:26 - Загрузка Excel: data/raw/sales.xlsx:Sheet1
2025-08-26 13:55:28 | INFO     | src.io.loader:35 - Excel loaded: data/raw/sales.xlsx sheet=Sheet1 shape=(1000, 4)
2025-08-26 13:55:28 | INFO     | src.pipelines.runner:23 - Concat all -> shapes: sales=(2200, 6) users=(0, 0) products=(0, 0)
2025-08-26 13:55:28 | INFO     | src.pipelines.runner:35 - Диапазон дат: 2024-08-21 00:00:00 — 2025-08-21 00:00:00; валюта: у.е.
2025-08-26 13:55:28 | INFO     | src.pipelines.runner:38 - Распределение строк по источникам: {'file': 2200}
2025-08-26 13:55:28 | INFO     | src.pipelines.clean_stage:64 - drop_high_missing_columns: dropped 1 columns: country
2025-08-26 13:55:28 | INFO     | src.pipelines.runner:43 - Очистка готова: stats={'sales_duplicates': 1000, 'sales_missing': {'order_id': 200, 'customer_id': 0, 'order_date': 200, 'amount': 200}}
2025-08-26 13:55:28 | INFO     | src.ml.stage:17 - ML отключён — пропускаем.
2025-08-26 13:55:29 | INFO     | src.reporting.report_stage.stage:89 - Агрегаты по источникам:
source  rows  amount_sum  amount_mean
  file  2200   169506.52     84.75326
2025-08-26 13:55:29 | INFO     | src.pipelines.runner:98 - Конвейер завершён
PASSED                                                                   [ 57%]
tests/test_validator.py::test_duplicates_and_missing PASSED              [ 71%]
tests/test_validator.py::test_types PASSED                               [ 85%]
tests/test_validator.py::test_outliers PASSED                            [100%]

==================================== PASSES ====================================
________________________________ test_load_csv _________________________________
------------------------------ Captured log call -------------------------------
INFO     src.io.loader:loader.py:19 CSV loaded: /tmp/pytest-of-al/pytest-6/test_load_csv0/t.csv shape=(2, 2)
_______________________________ test_load_excel ________________________________
------------------------------ Captured log call -------------------------------
INFO     src.io.loader:loader.py:35 Excel loaded: /tmp/pytest-of-al/pytest-6/test_load_excel0/t.xlsx sheet=None shape=(2, 2)
____________________________ test_pipeline_minimal _____________________________
----------------------------- Captured stdout call -----------------------------
{
  "raw": "data/processed/_combined_raw.parquet",
  "cleaned": "data/processed/cleaned.parquet",
  "stats": {
    "sales_duplicates": 1000,
    "sales_missing": {
      "order_id": 200,
      "customer_id": 0,
      "order_date": 200,
      "amount": 200
    }
  },
  "ml_metrics": {},
  "models": {},
  "artifacts": {
    "images": [],
    "pdf": "reports/pdf/report.pdf",
    "excel": "reports/excel/report.xlsx",
    "html": [
      "reports/html/monthly_revenue.html",
      "reports/html/top_customers.html"
    ]
  }
}
------------------------------ Captured log call -------------------------------
INFO     src.pipelines.runner:runner.py:19 Старт конвейера
INFO     src.pipelines.io_stage:io_stage.py:17 Загрузка CSV: data/raw/sales.csv
INFO     src.io.loader:loader.py:19 CSV loaded: data/raw/sales.csv shape=(1000, 4)
INFO     src.pipelines.io_stage:io_stage.py:17 Загрузка CSV: data/raw/customers.csv
INFO     src.io.loader:loader.py:19 CSV loaded: data/raw/customers.csv shape=(200, 2)
INFO     src.pipelines.io_stage:io_stage.py:26 Загрузка Excel: data/raw/sales.xlsx:Sheet1
INFO     src.io.loader:loader.py:35 Excel loaded: data/raw/sales.xlsx sheet=Sheet1 shape=(1000, 4)
INFO     src.pipelines.runner:runner.py:23 Concat all -> shapes: sales=(2200, 6) users=(0, 0) products=(0, 0)
INFO     src.pipelines.runner:runner.py:35 Диапазон дат: 2024-08-21 00:00:00 — 2025-08-21 00:00:00; валюта: у.е.
INFO     src.pipelines.runner:runner.py:38 Распределение строк по источникам: {'file': 2200}
INFO     src.pipelines.clean_stage:clean_stage.py:64 drop_high_missing_columns: dropped 1 columns: country
INFO     src.pipelines.runner:runner.py:43 Очистка готова: stats={'sales_duplicates': 1000, 'sales_missing': {'order_id': 200, 'customer_id': 0, 'order_date': 200, 'amount': 200}}
INFO     src.ml.stage:stage.py:17 ML отключён — пропускаем.
INFO     src.reporting.report_stage.stage:stage.py:89 Агрегаты по источникам:
source  rows  amount_sum  amount_mean
  file  2200   169506.52     84.75326
INFO     src.pipelines.runner:runner.py:98 Конвейер завершён
============================= slowest 10 durations =============================
1.60s call     tests/test_pipeline.py::test_pipeline_minimal
0.37s call     tests/test_loader.py::test_load_excel
0.02s call     tests/test_cleaner.py::test_impute_and_encode_and_scale_and_dates

(7 durations < 0.01s hidden.)
=========================== short test summary info ============================
PASSED tests/test_cleaner.py::test_impute_and_encode_and_scale_and_dates
PASSED tests/test_loader.py::test_load_csv
PASSED tests/test_loader.py::test_load_excel
PASSED tests/test_pipeline.py::test_pipeline_minimal
PASSED tests/test_validator.py::test_duplicates_and_missing
PASSED tests/test_validator.py::test_types
PASSED tests/test_validator.py::test_outliers
============================== 7 passed in 5.93s ===============================
